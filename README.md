# Message Board

Part 1 of the Google Cloud Platform demo.
This part demonstrates 
- how to deploy applications to **Firebase**, 
- how to work with **Cloud Functions**,
- how to work with **Google Managed Services** like **Natural Language API** and **Translate API**

This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 1.5.1.

## Context
Webshop bael.com wants to assess the customer satisfaction of its visitors after customers have placed an order.
They want to do this using a message board on which customers can place comments on their experience in the webshop.

A couple of characteristics:
- All messages are visible publicly and anyone can publish a message
- The **sentiment** of a message is calculated and **visualised** on the board
- Messages can be published in **any language**

## Solution
We will create an application with the following components:
- a Firebase backend,
- an Angular front end
- Google Managed Services: Translate API, Natural Language API

### Firebase backend
We will use Firebase by Google as a backend because of its:
- easy setup, 
- [Cloud Firestore](https://firebase.google.com/docs/firestore/),
- support for [Cloud functions](https://firebase.google.com/docs/functions/)
- Angular client library, [AngularFire2](https://github.com/angular/angularfire2)

#### Cloud Firestore
User messages will be stored in the Firebase Firestore, a NoSQL cloud database. When a user enters
a message, it's stored in this database and an event is triggered, signalling that a new message was entered.

This event will be processed by cloud functions to translate it and analyse the sentiment.

The result of the cloud functions is then stored back in the database and due to 3-way databinding, it's
immediately visible on all clients currently using the application.

#### Cloud functions
As described above, cloud functions are used to process new/updated messages.

##### Translate Message To English
This cloud function translates the message to English, as the name describes. 
It receives the message stored in the database and uses the Translate API to translate it from any language to English.
The result is stored back into the database into the "en" field of the message.

##### Check Message Sentiment
After the message is translated to English en saved, this function is triggered to check its sentiment.
It will take the English translation and send it to the Natural Language API for analysis.
The result is stored back into the database and visualised in all clients currently using the application.

##### Publish On Message Board
Extra cloud function that was added to listen to messages generated by Smeagol in part 2 of this demo.
Smeagol publishes quotes to a Google PubSub topic and this cloud function is subscribed to that topic.
When a message is published, the function will store it into the database, so it can be processed as if it was
any other message.

### Angular front end
The Angular front end allows the user to write messages, publish them to
the Firestore and see the last 20 messages published by other users.

Using the AngularFire2 and Firebase modules, all logic to communicate with the
Firebase backend is abstracted away.

## Setup
### Create a new Firebase project
First of all, we need a Firebase project to work on. Use the [Firebase Console](https://console.firebase.google.com)
to create a new project.
### Configure your Angular app to use your Firebase project
In order for your Front End to be able to connect with the Firebase Backend, you need to specify the Firebase project you want to work with.
AngularFire2 (as described later in dependencies) will use these specifications to setup communication with the Firebase backend.

The parameters you need, can be found in your project overview page, by clicking on the "Add Firebase to your project"
button.
### Configure Firebase CLI
In order to manage firebase applications locally (deploy, run locally, ...), you can install the Firebase CLI.
Documentation about this CLI can be found [here](https://firebase.google.com/docs/cli/). Underneath, you'll find the 
steps at the time of writing, but please check the documentation to get the most recent information.

Execute the following steps in your project folder:
1. Install Firebase CLI
   ``` 
   npm install -g firebase-tools --save
   ```
2. Login with Firebase account
   ``` 
   firebase login
   ```
3. Initialise project directory, **choose dist as the public directory**
   ``` 
   firebase init
   ```
### Enable the necessary APIs
In order for this application to function properly, the following APIs need to be enabled in your project:
- Google Cloud Natural Language API
- Google Cloud Translation API
- Google Cloud Functions API
- (Google Cloud Pub/Sub API) - Only necessary for other parts of the demo.

There is a [dashboard](https://console.cloud.google.com/apis/dashboard) available for your enabled APIs.

## Deploying Firebase Apps
After Configuring the project, you can now deploy your Firebase application.

Execute the following steps in your project folder:
1. Build your application so a dist is generated
    ```
    ng build
    ```
2. Deploy your entire application
    ```
    firebase deploy
    ```
    
If you only want to deploy specific parts of your application, you can also
do this using the --only or --except flags. Check the [documentation](https://firebase.google.com/docs/cli/) for
more details.

Your application is now ready to be used.

## Dependencies
### AngularFire2 + Firebase
These modules are used to integrate the Front End with the Firebase Backend. Among many other things,
they allow 3-way databinding with the data in the Firebase Realtime Database.

More information can be found [here](https://github.com/angular/angularfire2). 

### @google-cloud/language + @google-cloud/pubsub
Modules provided by Google to simplify working with Google Cloud APIs like Natural Language API and PubSub.
PubSub is not necessary for this part of the demo, but is added due to modifications for later parts of the demo.
